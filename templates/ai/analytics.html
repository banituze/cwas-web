{% extends "base.html" %}
{% block title %}Analytics{% endblock %}
{% block page_title %}AI Analytics{% endblock %}
{% block content %}
<div class="stats-grid">
    <div class="stat-card"><div class="stat-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg></div><div class="stat-content"><div class="stat-value">{{ daily_bookings|length }}</div><div class="stat-label">Days with Data</div></div></div>
    <div class="stat-card"><div class="stat-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg></div><div class="stat-content"><div class="stat-value">{{ source_stats|length }}</div><div class="stat-label">Sources Tracked</div></div></div>
    <div class="stat-card"><div class="stat-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/></svg></div><div class="stat-content"><div class="stat-value">{{ alerts|length }}</div><div class="stat-label">Active Alerts</div></div></div>
</div>
<div class="grid grid-2 mb-6">
    <div class="card"><h3 class="mb-4">Booking Trends (30 Days)</h3>{% if daily_bookings %}<div style="height:200px;display:flex;align-items:flex-end;gap:4px">{% for d in daily_bookings %}<div style="flex:1;background:var(--primary);border-radius:4px 4px 0 0;height:{{ (d.count * 10)|min(200) }}px" title="{{ d.booking_date }}: {{ d.count }} bookings"></div>{% endfor %}</div>{% else %}<p class="text-muted">No data available</p>{% endif %}</div>
    <div class="card"><h3 class="mb-4">Revenue by Region</h3>{% for r in revenue_by_region %}<div style="margin-bottom:12px"><div class="flex justify-between mb-1"><span>{{ r.region }}</span><span>{{ "{:,.0f}".format(r.revenue) }} Ar</span></div><div style="height:8px;background:var(--border-color);border-radius:4px"><div style="height:100%;background:var(--primary);border-radius:4px;width:{{ (r.revenue / (revenue_by_region[0].revenue or 1) * 100)|int }}%"></div></div></div>{% endfor %}</div>
</div>
<div class="card">
    <h3 class="mb-4">Source Utilization</h3>
    <div class="table-container"><table class="table"><thead><tr><th>Source</th><th>Capacity</th><th>Bookings</th><th>Water Distributed</th><th>Utilization</th></tr></thead><tbody>
    {% for s in source_stats %}<tr><td>{{ s.name }}</td><td>{{ "{:,}".format(s.capacity_liters) }}L</td><td>{{ s.booking_count }}</td><td>{{ "{:,.0f}".format(s.total_booked) }}L</td><td><div style="width:100px;height:8px;background:var(--border-color);border-radius:4px"><div style="height:100%;background:var(--primary);border-radius:4px;width:{{ ((s.total_booked / (s.capacity_liters * 30)) * 100)|min(100)|int }}%"></div></div></td></tr>{% endfor %}
    </tbody></table></div>
</div>
{% endblock %}
